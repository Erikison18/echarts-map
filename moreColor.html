<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>echarts中国地图</title>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        border: 0;
        width: 100%;
        height: 100%;
        background-color: #182533;
      }
      .page {
        margin: 0;
        padding: 0;
        border: 0;
        width: 100%;
        height: 100%;
        transform-origin: left top;
      }
      .centerItem {
        width: 100%;
        height: 100%;
        position: relative;
        background-color: #182533;
        margin: 0px auto 0 auto;
      }
      .childdiv {
        width: 60px;
        height: 60px;
        position: absolute;
        top: 500px;
        left: 500px;
        display: none;
      }
      .tooltip {
        position: absolute;
        bottom: 20px;
        left: 20px;
        color: #fff;
      }
      .tooltip p {
        position: relative;
        padding-left: 40px;
      }
      .tooltip p::before {
        content: "";
        display: block;
        width: 30px;
        height: 8px;
        background-color: #fbf306;
        position: absolute;
        left: 0;
        top: 50%;
        transform: translateY(-50%);
      }
      .tooltip p:nth-child(2)::before {
        background-color: #fad505;
      }
      .tooltip p:nth-child(3)::before {
        background-color: #3267d2;
      }
      .tooltip p:nth-child(4)::before {
        background-color: #4e7fe3;
      }
      .tooltip p:nth-child(5)::before {
        background-color: #e97551;
      }
      .tooltip p:nth-child(6)::before {
        background-color: #e98d51;
      }
      .tooltip img {
        margin-right: 16px;
        vertical-align: text-bottom;
      }
    </style>
  </head>

  <body>
    <div class="page">
      <!-- 中国地图展示 -->
      <div id="china-map" class="centerItem"></div>
      <div class="tooltip">
        <p><img src="./img/人口人流.png" />人口人流</p>
        <p><img src="./img/短信发送.png" />短信发送</p>
        <p><img src="./img/离线.png" />离线</p>
        <p><img src="./img/实时.png" />实时</p>
        <p><img src="./img/洞察云.png" />洞察云</p>
        <p><img src="./img/营销云.png" />营销云</p>
      </div>
    </div>
    <!-- 引入相关文件 -->
    <!-- <script src="js/jquery-3.2.1.min.js"></script> -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <!-- 引入 ECharts 文件 -->
    <script src="./js/echarts.js"></script>
    <script src="./js/china.js"></script>
    <script src="./js/geo.js"></script>
    <script>
      var data = [
        {
          name: "北京",
          value: 2,
          population: true,
          sms: false,
          offLine: true,
          realLine: false,
          insightClound: true,
          marketCloud: false,
        },
        {
          name: "天津",
          value: 12,
          population: false,
          sms: false,
          offLine: false,
          realLine: false,
          insightClound: false,
          marketCloud: false,
        },
        {
          name: "上海",
          value: 12,
          population: false,
          sms: true,
          offLine: true,
          realLine: true,
          insightClound: true,
          marketCloud: true,
        },
        {
          name: "重庆",
          value: 2,
          population: true,
          sms: false,
          offLine: true,
          realLine: false,
          insightClound: true,
          marketCloud: false,
        },
        {
          name: "河北",
          value: 2,
          population: true,
          sms: true,
          offLine: true,
          realLine: true,
          insightClound: true,
          marketCloud: true,
        },
        {
          name: "河南",
          value: 22,
          population: true,
          sms: true,
          offLine: true,
          realLine: true,
          insightClound: true,
          marketCloud: true,
        },
        {
          name: "云南",
          value: 12,
          population: true,
          sms: true,
          offLine: true,
          realLine: true,
          insightClound: true,
          marketCloud: true,
        },
        {
          name: "辽宁",
          value: 12,
          population: true,
          sms: true,
          offLine: true,
          realLine: true,
          insightClound: true,
          marketCloud: true,
        },
        {
          name: "黑龙江",
          value: 2,
          population: true,
          sms: true,
          offLine: true,
          realLine: true,
          insightClound: true,
          marketCloud: true,
        },
        {
          name: "湖南",
          value: 32,
          population: true,
          sms: true,
          offLine: true,
          realLine: true,
          insightClound: true,
          marketCloud: true,
        },
        {
          name: "安徽",
          value: 32,
          population: true,
          sms: true,
          offLine: true,
          realLine: true,
          insightClound: true,
          marketCloud: true,
        },
        {
          name: "山东",
          value: 2,
          population: true,
          sms: true,
          offLine: true,
          realLine: true,
          insightClound: true,
          marketCloud: true,
        },
        {
          name: "新疆",
          value: 2,
          population: true,
          sms: true,
          offLine: true,
          realLine: true,
          insightClound: true,
          marketCloud: true,
        },
        {
          name: "江苏",
          value: 22,
          population: true,
          sms: true,
          offLine: true,
          realLine: true,
          insightClound: true,
          marketCloud: true,
        },
        {
          name: "浙江",
          value: 22,
          population: true,
          sms: true,
          offLine: true,
          realLine: true,
          insightClound: true,
          marketCloud: true,
        },
        {
          name: "江西",
          value: 22,
          population: true,
          sms: true,
          offLine: true,
          realLine: true,
          insightClound: true,
          marketCloud: true,
        },
        {
          name: "湖北",
          value: 22,
          population: true,
          sms: true,
          offLine: true,
          realLine: true,
          insightClound: true,
          marketCloud: true,
        },
        {
          name: "广西",
          value: 22,
          population: true,
          sms: true,
          offLine: true,
          realLine: true,
          insightClound: true,
          marketCloud: true,
        },
        {
          name: "甘肃",
          value: 32,
          population: true,
          sms: true,
          offLine: true,
          realLine: true,
          insightClound: true,
          marketCloud: true,
        },
        {
          name: "山西",
          value: 22,
          population: true,
          sms: true,
          offLine: true,
          realLine: true,
          insightClound: true,
          marketCloud: true,
        },
        {
          name: "内蒙古",
          value: 22,
          population: true,
          sms: true,
          offLine: true,
          realLine: true,
          insightClound: true,
          marketCloud: true,
        },
        {
          name: "陕西",
          value: 2,
          population: true,
          sms: true,
          offLine: true,
          realLine: true,
          insightClound: true,
          marketCloud: true,
        },
        {
          name: "吉林",
          value: 22,
          population: true,
          sms: true,
          offLine: true,
          realLine: true,
          insightClound: true,
          marketCloud: true,
        },
        {
          name: "福建",
          value: 22,
          population: true,
          sms: true,
          offLine: true,
          realLine: true,
          insightClound: true,
          marketCloud: true,
        },
        {
          name: "贵州",
          value: 32,
          population: true,
          sms: true,
          offLine: true,
          realLine: true,
          insightClound: true,
          marketCloud: true,
        },
        {
          name: "广东",
          value: 22,
          population: true,
          sms: true,
          offLine: true,
          realLine: true,
          insightClound: true,
          marketCloud: true,
        },
        {
          name: "青海",
          value: 2,
          population: true,
          sms: true,
          offLine: true,
          realLine: true,
          insightClound: true,
          marketCloud: true,
        },
        {
          name: "西藏",
          value: 22,
          population: true,
          sms: true,
          offLine: false,
          realLine: true,
          insightClound: true,
          marketCloud: true,
        },
        {
          name: "四川",
          value: 12,
          population: true,
          sms: true,
          offLine: false,
          realLine: true,
          insightClound: true,
          marketCloud: true,
        },
        {
          name: "宁夏",
          value: 32,
          population: true,
          sms: true,
          offLine: true,
          realLine: true,
          insightClound: true,
          marketCloud: true,
        },
        {
          name: "海南",
          value: 32,
          population: false,
          sms: true,
          offLine: true,
          realLine: false,
          insightClound: true,
          marketCloud: true,
        },
        {
          name: "台湾",
          value: 22,
          population: false,
          sms: false,
          offLine: false,
          realLine: false,
          insightClound: false,
          marketCloud: false,
        },
        {
          name: "香港",
          value: 22,
          population: true,
          sms: true,
          offLine: true,
          realLine: true,
          insightClound: true,
          marketCloud: true,
        },
        {
          name: "澳门",
          value: 22,
          population: true,
          sms: true,
          offLine: false,
          realLine: true,
          insightClound: true,
          marketCloud: false,
        },
      ];
      var picInfoList = [];
    </script>
    <script>
      let childList = data
        .filter((item) => {
          return (
            item.name != "香港" && item.name != "澳门" && item.name != "台湾"
          );
        })
        .map((item, index) => {
          //console.log(index);
          var parentdiv = $(".page");
          var childdiv = $(
            "<div class='childdiv' data-privence=" + item.name + "></div>"
          ); //创建一个子div
          childdiv.attr("id", "child" + index); //给子div设置id
          childdiv.appendTo(parentdiv); //将子div添加到父div中
          return item;
        });

      childList.map((item, i) => {
        var childEchart = echarts.init(document.getElementById("child" + i));
        let gray = "#ccc";
        //console.log(item, i)
        var childOption = {
          grid: {
            left: 0,
            top: 0,
            right: 0,
            bottom: 0,
          },
          color: [
            item.population ? "#FBF306" : "#ccc",
            item.sms ? "#FAD505" : "#ccc",
            item.offLine ? "#3267D2" : "#ccc",
            item.realLine ? "#4E7FE3" : "#ccc",
            item.insightClound ? "#E97551" : "#ccc",
            item.marketCloud ? "#E98D51" : "#ccc",
          ],
          series: [
            {
              name: "访问来源",
              type: "pie",
              radius: "100%",
              silent: true,
              label: {
                show: true,
                position: "inside",
                formatter: (item) => {
                  return '{w|'+item.name.slice(0,2)+'}';
                  //return text;
                },
                rich: {
                  w: {
                    color: "#663366",
                    fontWeight: "bold",
                    fontSize: 8,
                  },
                },
              },
              emphasis: {
                scale: false,
              },
              data: [
                { value: 1, name: "人口人流" },
                { value: 1, name: "短信发送" },
                { value: 1, name: "离线" },
                { value: 1, name: "实时" },
                { value: 1, name: "洞察云" },
                { value: 1, name: "营销云" },
              ],
            },
          ],
        };
        childEchart.setOption(childOption);

        childEchart.on("finished", {}, function () {
          //console.log("finished", childEchart);
          var picInfo = childEchart.getDataURL({
            type: "png",
            pixelRatio: 2, //放大两倍下载，之后压缩到同等大小展示。解决生成图片在移动端模糊问题
          }); //获取到的是一串base64信息
          picInfoList.push(picInfo);
          //console.log(picInfo)
          if (picInfoList.length === 31) {
            // 基于准备好的dom，初始化echarts实例
            var mapBoxEchart = echarts.init(
              document.getElementById("china-map")
            );

            var convertData = function (data) {
              var res = [];
              for (var i = 0; i < data.length; i++) {
                var geoCoord = geoCoordMap[data[i].name];
                if (geoCoord) {
                  res.push({
                    name: data[i].name,
                    value: geoCoord.concat(data[i].value),
                  });
                }
              }
              return res;
            };
            // 指定相关的配置项和数据
            var mapBoxOption = {
              geo: {
                show: false,
                map: "china",
                aspectScale: 0.75,
                zoom: 1.2,
                label: {
                  normal: {
                    show: false,
                  },
                  emphasis: {
                    show: false,
                  },
                },
                roam: false,
                itemStyle: {
                  normal: {
                    show: false,
                  },
                  emphasis: {
                    show: false, //areaColor: "#2B91B7",
                  },
                },
              },
              visualMap: {
                seriesIndex: 0,
                orient: "horizontal",
                splitNumber: 2,
                min: 0,
                max: 1000000,
                left: "2%",
                top: "2%",
                right: "40%",
                type: "piecewise",
                align: "left",
                itemSymbol: "rect",
                itemWidth: 28,
                itemHeight: 28,
                textGap: 10,
                itemGap: 20,
                textStyle: {
                  color: "#FFF",
                  fontSize: 18,
                  lineHeight: 20,
                },
                color: "green",
                pieces: [
                  {
                    gte: 1,
                    lte: 10,
                    color: "#50E874",
                    label: "具备商务拓展省市",
                  },
                  {
                    gte: 11,
                    lte: 20,
                    color: "#50E9E6",
                    label: "建设中,部分完成",
                  },
                  {
                    gte: 31,
                    lte: 40,
                    color: "#50B5EA",
                    label: "沟通过程中",
                  },
                  {
                    gte: 21,
                    lte: 30,
                    color: "#4E7Ba6", //#4E7FE3
                    label: "无较大进展地方",
                  },
                ],
              },
              series: [
                {
                  type: "map",
                  mapType: "china",
                  label: {
                    normal: {
                      show: true, //显示省份标签
                      textStyle: {
                        color: "#000",
                        fontSize: 14,
                      }, //省份标签字体颜色
                    },
                    emphasis: {
                      //对应的鼠标悬浮效果
                      show: false,
                      textStyle: {
                        color: "#800080",
                      },
                    },
                  },
                  aspectScale: 0.75,
                  zoom: 1.2,
                  itemStyle: {
                    normal: {
                      borderWidth: 0.5, //区域边框宽度
                      borderColor: "#009fe8", //区域边框颜色
                      areaColor: "#ffefd5", //区域颜色
                    },
                    emphasis: {
                      borderWidth: 0.5,
                      borderColor: "#4b0082",
                      areaColor: "#ffdead",
                    },
                  },
                  data: data, //各省地图颜色数据依赖value
                },
                //每增加一个name就增加一个图标，同时需要在geo.js中增加内容，内容中的经纬度会控制图标所在省份位置
                //也需要在上面增加var 数组与geo.js的数组对应，data: convertData(xxx), xxx与var参数名一致
                //symbol参数:‘circle’, ‘rect’, ‘roundRect’, ‘triangle’, ‘diamond’, ‘pin’, ‘arrow’
                {
                  name: "有名字有图标",
                  type: "scatter",
                  coordinateSystem: "geo",
                  symbol: (number, obj) => {
                    return "image://" + picInfoList[obj.dataIndex];
                  },
                  symbolSize: [60, 60],
                  label: {
                    normal: {
                      show: true,
                      textStyle: {
                        color: "#fff",
                        fontSize: 9,
                      },
                      formatter(value) {
                        return "";
                        return value.data.value[2];
                      },
                    },
                  },
                  itemStyle: {
                    normal: {
                      color: "#D80007", //标志颜色
                    },
                  },
                  data: convertData(data),
                  showEffectOn: "render",
                  rippleEffect: {
                    brushType: "stroke",
                  },
                  hoverAnimation: true,
                  zlevel: 0,
                },
              ],
            };
            // 使用制定的配置项和数据显示图表
            mapBoxEchart.setOption(mapBoxOption);
            mapBoxEchart.off("click");
            // echart图表自适应
            window.addEventListener("resize", function () {
              mapBoxEchart.resize();
            });
          }
        });
      });
    </script>
    <script defer="defer"></script>
  </body>
</html>
